const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-in9isEBO.js","./basedecoder-B2c5_Eok.js","./lzw-_aCqfs4w.js","./jpeg-CKYXsxFN.js","./deflate-B9JhHpvg.js","./pako.esm-Cram60i4.js","./packbits-DDWKfGV_.js","./lerc-DScxcuGR.js","./_commonjsHelpers-CqkleIqs.js","./index-oVuhQ0-D.js","./vendor-lC3ks3hR.js","./webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
import{g as yt}from"./_commonjsHelpers-CqkleIqs.js";import{_ as J,o as ve,t as qt,s as We,a as Yt,W as Ht,e as $t,g as Te,c as Zt,b as Ae,d as Je,D as Tt,f as oe,h as Qe,T as U,i as Wt,j as Jt,k as Qt,l as er,m as tr,u as et,E as _t,n as rr,p as ir,q as sr,r as Ge,w as nr,v as or,x as ar,y as cr,z as be,A as Se,B as Ie,C as lr,F as hr,G as Le,H as fr,I as Re,J as tt,K as rt,L as ur,M as dr,N as gr,O as mr,P as xr,Q as pr,R as yr,S as it,U as st,V as Tr,X as _r}from"./index-oVuhQ0-D.js";function N(r){return(e,...t)=>Er(r,e,t)}function se(r,e){return N(Et(r,e).get)}const{apply:Er,getOwnPropertyDescriptor:Et,getPrototypeOf:je,ownKeys:wr}=Reflect,{iterator:he,toStringTag:Ar}=Symbol,br=Object,{create:ze,defineProperty:Sr}=br,Ir=Array,Rr=Ir.prototype,wt=Rr[he],Dr=N(wt),At=ArrayBuffer,Fr=At.prototype;se(Fr,"byteLength");const nt=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;nt&&se(nt.prototype,"byteLength");const bt=je(Uint8Array);bt.from;const z=bt.prototype;z[he];N(z.keys);N(z.values);N(z.entries);N(z.set);N(z.reverse);N(z.fill);N(z.copyWithin);N(z.sort);N(z.slice);N(z.subarray);se(z,"buffer");se(z,"byteOffset");se(z,"length");se(z,Ar);const Pr=Uint8Array,St=Uint16Array,Ve=Uint32Array,Mr=Float32Array,le=je([][he]()),It=N(le.next),Cr=N(function*(){}().next),vr=je(le),Gr=DataView.prototype,Lr=N(Gr.getUint16),Ke=WeakMap,Rt=Ke.prototype,Dt=N(Rt.get),Or=N(Rt.set),Ft=new Ke,Ur=ze(null,{next:{value:function(){const e=Dt(Ft,this);return It(e)}},[he]:{value:function(){return this}}});function Br(r){if(r[he]===wt&&le.next===It)return r;const e=ze(Ur);return Or(Ft,e,Dr(r)),e}const kr=new Ke,Nr=ze(vr,{next:{value:function(){const e=Dt(kr,this);return Cr(e)},writable:!0,configurable:!0}});for(const r of wr(le))r!=="next"&&Sr(Nr,r,Et(le,r));const Pt=new At(4),jr=new Mr(Pt),zr=new Ve(Pt),$=new St(512),Z=new Pr(512);for(let r=0;r<256;++r){const e=r-127;e<-24?($[r]=0,$[r|256]=32768,Z[r]=24,Z[r|256]=24):e<-14?($[r]=1024>>-e-14,$[r|256]=1024>>-e-14|32768,Z[r]=-e-1,Z[r|256]=-e-1):e<=15?($[r]=e+15<<10,$[r|256]=e+15<<10|32768,Z[r]=13,Z[r|256]=13):e<128?($[r]=31744,$[r|256]=64512,Z[r]=24,Z[r|256]=24):($[r]=31744,$[r|256]=64512,Z[r]=13,Z[r|256]=13)}const Xe=new Ve(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;(e&8388608)===0;)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Xe[r]=e|t}for(let r=1024;r<2048;++r)Xe[r]=939524096+(r-1024<<13);const ne=new Ve(64);for(let r=1;r<31;++r)ne[r]=r<<23;ne[31]=1199570944;ne[32]=2147483648;for(let r=33;r<63;++r)ne[r]=2147483648+(r-32<<23);ne[63]=3347054592;const Mt=new St(64);for(let r=1;r<64;++r)r!==32&&(Mt[r]=1024);function Vr(r){const e=r>>10;return zr[0]=Xe[Mt[e]+(r&1023)]+ne[e],jr[0]}function Ct(r,e,...t){return Vr(Lr(r,e,...Br(t)))}var ue={exports:{}},ot;function Kr(){if(ot)return ue.exports;ot=1;function r(e,t,i){const s=i&&i.debug||!1;s&&console.log("[xml-utils] getting "+t+" in "+e);const n=typeof e=="object"?e.outer:e,o=n.slice(0,n.indexOf(">")+1),a=['"',"'"];for(let l=0;l<a.length;l++){const h=a[l],u=t+"\\="+h+"([^"+h+"]*)"+h;s&&console.log("[xml-utils] pattern:",u);const g=new RegExp(u).exec(o);if(s&&console.log("[xml-utils] match:",g),g)return g[1]}}return ue.exports=r,ue.exports.default=r,ue.exports}var Xr=Kr();const De=yt(Xr);var de={exports:{}},ge={exports:{}},me={exports:{}},at;function qr(){if(at)return me.exports;at=1;function r(e,t,i){const n=new RegExp(t).exec(e.slice(i));return n?i+n.index:-1}return me.exports=r,me.exports.default=r,me.exports}var xe={exports:{}},ct;function Yr(){if(ct)return xe.exports;ct=1;function r(e,t,i){const n=new RegExp(t).exec(e.slice(i));return n?i+n.index+n[0].length-1:-1}return xe.exports=r,xe.exports.default=r,xe.exports}var pe={exports:{}},lt;function Hr(){if(lt)return pe.exports;lt=1;function r(e,t){const i=new RegExp(t,"g"),s=e.match(i);return s?s.length:0}return pe.exports=r,pe.exports.default=r,pe.exports}var ht;function $r(){if(ht)return ge.exports;ht=1;const r=qr(),e=Yr(),t=Hr();function i(s,n,o){const a=o&&o.debug||!1,l=!(o&&typeof o.nested===!1),h=o&&o.startIndex||0;a&&console.log("[xml-utils] starting findTagByName with",n," and ",o);const u=r(s,`<${n}[ 
>/]`,h);if(a&&console.log("[xml-utils] start:",u),u===-1)return;const f=s.slice(u+n.length);let g=e(f,"^[^<]*[ /]>",0);const m=g!==-1&&f[g-1]==="/";if(a&&console.log("[xml-utils] selfClosing:",m),m===!1)if(l){let y=0,p=1,T=0;for(;(g=e(f,"[ /]"+n+">",y))!==-1;){const _=f.substring(y,g+1);if(p+=t(_,"<"+n+`[ 
	>]`),T+=t(_,"</"+n+">"),T>=p)break;y=g}}else g=e(f,"[ /]"+n+">",0);const c=u+n.length+g+1;if(a&&console.log("[xml-utils] end:",c),c===-1)return;const x=s.slice(u,c);let d;return m?d=null:d=x.slice(x.indexOf(">")+1,x.lastIndexOf("<")),{inner:d,outer:x,start:u,end:c}}return ge.exports=i,ge.exports.default=i,ge.exports}var ft;function Zr(){if(ft)return de.exports;ft=1;const r=$r();function e(t,i,s){const n=[],o=s&&s.debug||!1,a=s&&typeof s.nested=="boolean"?s.nested:!0;let l=s&&s.startIndex||0,h;for(;h=r(t,i,{debug:o,startIndex:l});)a?l=h.start+1+i.length:l=h.end,n.push(h);return o&&console.log("findTagsByName found",n.length,"tags"),n}return de.exports=e,de.exports.default=e,de.exports}var Wr=Zr();const Jr=yt(Wr),ce={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},W={};for(const r in ce)ce.hasOwnProperty(r)&&(W[ce[r]]=parseInt(r,10));const Qr=[W.BitsPerSample,W.ExtraSamples,W.SampleFormat,W.StripByteCounts,W.StripOffsets,W.StripRowCounts,W.TileByteCounts,W.TileOffsets,W.SubIFDs],Fe={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},S={};for(const r in Fe)Fe.hasOwnProperty(r)&&(S[Fe[r]]=parseInt(r,10));const V={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},ei={Unspecified:0},ws={AddCompression:1},As={None:0,Deflate:1,Zstandard:2},ti={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function ri(r,e){const{width:t,height:i}=r,s=new Uint8Array(t*i*3);let n;for(let o=0,a=0;o<r.length;++o,a+=3)n=256-r[o]/e*256,s[a]=n,s[a+1]=n,s[a+2]=n;return s}function ii(r,e){const{width:t,height:i}=r,s=new Uint8Array(t*i*3);let n;for(let o=0,a=0;o<r.length;++o,a+=3)n=r[o]/e*256,s[a]=n,s[a+1]=n,s[a+2]=n;return s}function si(r,e){const{width:t,height:i}=r,s=new Uint8Array(t*i*3),n=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<r.length;++a,l+=3){const h=r[a];s[l]=e[h]/65536*256,s[l+1]=e[h+n]/65536*256,s[l+2]=e[h+o]/65536*256}return s}function ni(r){const{width:e,height:t}=r,i=new Uint8Array(e*t*3);for(let s=0,n=0;s<r.length;s+=4,n+=3){const o=r[s],a=r[s+1],l=r[s+2],h=r[s+3];i[n]=255*((255-o)/256)*((255-h)/256),i[n+1]=255*((255-a)/256)*((255-h)/256),i[n+2]=255*((255-l)/256)*((255-h)/256)}return i}function oi(r){const{width:e,height:t}=r,i=new Uint8ClampedArray(e*t*3);for(let s=0,n=0;s<r.length;s+=3,n+=3){const o=r[s],a=r[s+1],l=r[s+2];i[n]=o+1.402*(l-128),i[n+1]=o-.34414*(a-128)-.71414*(l-128),i[n+2]=o+1.772*(a-128)}return i}const ai=.95047,ci=1,li=1.08883;function hi(r){const{width:e,height:t}=r,i=new Uint8Array(e*t*3);for(let s=0,n=0;s<r.length;s+=3,n+=3){const o=r[s+0],a=r[s+1]<<24>>24,l=r[s+2]<<24>>24;let h=(o+16)/116,u=a/500+h,f=h-l/200,g,m,c;u=ai*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),h=ci*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),f=li*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),g=u*3.2406+h*-1.5372+f*-.4986,m=u*-.9689+h*1.8758+f*.0415,c=u*.0557+h*-.204+f*1.057,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,c=c>.0031308?1.055*c**(1/2.4)-.055:12.92*c,i[n]=Math.max(0,Math.min(1,g))*255,i[n+1]=Math.max(0,Math.min(1,m))*255,i[n+2]=Math.max(0,Math.min(1,c))*255}return i}const vt=new Map;function Q(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>vt.set(t,e))}async function Gt(r){const e=vt.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}Q([void 0,1],()=>J(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.default));Q(5,()=>J(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1]),import.meta.url).then(r=>r.default));Q(6,()=>{throw new Error("old style JPEG compression is not supported.")});Q(7,()=>J(()=>import("./jpeg-CKYXsxFN.js"),__vite__mapDeps([3,1]),import.meta.url).then(r=>r.default));Q([8,32946],()=>J(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(r=>r.default));Q(32773,()=>J(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1]),import.meta.url).then(r=>r.default));Q(34887,()=>J(()=>import("./lerc-DScxcuGR.js"),__vite__mapDeps([7,5,8,1,9,10]),import.meta.url).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));Q(50001,()=>J(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([11,1]),import.meta.url).then(r=>r.default));function Ee(r,e,t,i=1){return new(Object.getPrototypeOf(r)).constructor(e*t*i)}function fi(r,e,t,i,s){const n=e/i,o=t/s;return r.map(a=>{const l=Ee(a,i,s);for(let h=0;h<s;++h){const u=Math.min(Math.round(o*h),t-1);for(let f=0;f<i;++f){const g=Math.min(Math.round(n*f),e-1),m=a[u*e+g];l[h*i+f]=m}}return l})}function re(r,e,t){return(1-t)*r+t*e}function ui(r,e,t,i,s){const n=e/i,o=t/s;return r.map(a=>{const l=Ee(a,i,s);for(let h=0;h<s;++h){const u=o*h,f=Math.floor(u),g=Math.min(Math.ceil(u),t-1);for(let m=0;m<i;++m){const c=n*m,x=c%1,d=Math.floor(c),y=Math.min(Math.ceil(c),e-1),p=a[f*e+d],T=a[f*e+y],_=a[g*e+d],E=a[g*e+y],I=re(re(p,T,x),re(_,E,x),u%1);l[h*i+m]=I}}return l})}function di(r,e,t,i,s,n="nearest"){switch(n.toLowerCase()){case"nearest":return fi(r,e,t,i,s);case"bilinear":case"linear":return ui(r,e,t,i,s);default:throw new Error(`Unsupported resampling method: '${n}'`)}}function gi(r,e,t,i,s,n){const o=e/i,a=t/s,l=Ee(r,i,s,n);for(let h=0;h<s;++h){const u=Math.min(Math.round(a*h),t-1);for(let f=0;f<i;++f){const g=Math.min(Math.round(o*f),e-1);for(let m=0;m<n;++m){const c=r[u*e*n+g*n+m];l[h*i*n+f*n+m]=c}}}return l}function mi(r,e,t,i,s,n){const o=e/i,a=t/s,l=Ee(r,i,s,n);for(let h=0;h<s;++h){const u=a*h,f=Math.floor(u),g=Math.min(Math.ceil(u),t-1);for(let m=0;m<i;++m){const c=o*m,x=c%1,d=Math.floor(c),y=Math.min(Math.ceil(c),e-1);for(let p=0;p<n;++p){const T=r[f*e*n+d*n+p],_=r[f*e*n+y*n+p],E=r[g*e*n+d*n+p],I=r[g*e*n+y*n+p],R=re(re(T,_,x),re(E,I,x),u%1);l[h*i*n+m*n+p]=R}}}return l}function xi(r,e,t,i,s,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return gi(r,e,t,i,s,n);case"bilinear":case"linear":return mi(r,e,t,i,s,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function pi(r,e,t){let i=0;for(let s=e;s<t;++s)i+=r[s];return i}function Oe(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function yi(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function Ti(r,e,t,i,s,n,o){const a=new DataView(r),l=t===2?o*n:o*n*i,h=t===2?1:i,u=Oe(e,s,l),f=parseInt("1".repeat(s),2);if(e===1){let g;t===1?g=i*s:g=s;let m=n*g;(m&7)!==0&&(m=m+7&-8);for(let c=0;c<o;++c){const x=c*m;for(let d=0;d<n;++d){const y=x+d*h*s;for(let p=0;p<h;++p){const T=y+p*s,_=(c*n+d)*h+p,E=Math.floor(T/8),I=T%8;if(I+s<=8)u[_]=a.getUint8(E)>>8-s-I&f;else if(I+s<=16)u[_]=a.getUint16(E)>>16-s-I&f;else if(I+s<=24){const R=a.getUint16(E)<<8|a.getUint8(E+2);u[_]=R>>24-s-I&f}else u[_]=a.getUint32(E)>>32-s-I&f}}}}return u.buffer}class Lt{constructor(e,t,i,s,n,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=i,this.littleEndian=s,this.tiles=n?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(s,n){return Ct(this,s,n)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const i=this.getSampleFormat(e),s=this.getBitsPerSample(e);return Oe(i,s,t)}async getTileOrStrip(e,t,i,s,n){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=i*o*a+t*o+e);let u,f;this.isTiled?(u=this.fileDirectory.TileOffsets[l],f=this.fileDirectory.TileByteCounts[l]):(u=this.fileDirectory.StripOffsets[l],f=this.fileDirectory.StripByteCounts[l]);const g=(await this.source.fetch([{offset:u,length:f}],n))[0];let m;return h===null||!h[l]?(m=(async()=>{let c=await s.decode(this.fileDirectory,g);const x=this.getSampleFormat(),d=this.getBitsPerSample();return yi(x,d)&&(c=Ti(c,x,this.planarConfiguration,this.getSamplesPerPixel(),d,this.getTileWidth(),this.getBlockHeight(t))),c})(),h!==null&&(h[l]=m)):m=h[l],{x:e,y:t,sample:i,data:await m}}async _readRaster(e,t,i,s,n,o,a,l,h){const u=this.getTileWidth(),f=this.getTileHeight(),g=this.getWidth(),m=this.getHeight(),c=Math.max(Math.floor(e[0]/u),0),x=Math.min(Math.ceil(e[2]/u),Math.ceil(g/u)),d=Math.max(Math.floor(e[1]/f),0),y=Math.min(Math.ceil(e[3]/f),Math.ceil(m/f)),p=e[2]-e[0];let T=this.getBytesPerPixel();const _=[],E=[];for(let A=0;A<t.length;++A)this.planarConfiguration===1?_.push(pi(this.fileDirectory.BitsPerSample,0,t[A])/8):_.push(0),E.push(this.getReaderForSample(t[A]));const I=[],{littleEndian:R}=this;for(let A=d;A<y;++A)for(let F=c;F<x;++F){let w;this.planarConfiguration===1&&(w=this.getTileOrStrip(F,A,0,n,h));for(let P=0;P<t.length;++P){const b=P,M=t[P];this.planarConfiguration===2&&(T=this.getSampleByteSize(M),w=this.getTileOrStrip(F,A,M,n,h));const G=w.then(D=>{const k=D.data,C=new DataView(k),j=this.getBlockHeight(D.y),L=D.y*f,v=D.x*u,B=L+j,q=(D.x+1)*u,O=E[b],K=Math.min(j,j-(B-e[3]),m-L),Y=Math.min(u,u-(q-e[2]),g-v);for(let X=Math.max(0,e[1]-L);X<K;++X)for(let H=Math.max(0,e[0]-v);H<Y;++H){const we=(X*u+H)*T,fe=O.call(C,we+_[b],R);let ee;s?(ee=(X+L-e[1])*p*t.length+(H+v-e[0])*t.length+b,i[ee]=fe):(ee=(X+L-e[1])*p+H+v-e[0],i[b][ee]=fe)}});I.push(G)}}if(await Promise.all(I),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let A;return s?A=xi(i,e[2]-e[0],e[3]-e[1],o,a,t.length,l):A=di(i,e[2]-e[0],e[3]-e[1],o,a,l),A.width=o,A.height=a,A}return i.width=o||e[2]-e[0],i.height=a||e[3]-e[1],i}async readRasters({window:e,samples:t=[],interleave:i,pool:s=null,width:n,height:o,resampleMethod:a,fillValue:l,signal:h}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const f=u[2]-u[0],g=u[3]-u[1],m=f*g,c=this.getSamplesPerPixel();if(!t||!t.length)for(let p=0;p<c;++p)t.push(p);else for(let p=0;p<t.length;++p)if(t[p]>=c)return Promise.reject(new RangeError(`Invalid sample index '${t[p]}'.`));let x;if(i){const p=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,T=Math.max.apply(null,this.fileDirectory.BitsPerSample);x=Oe(p,T,m*t.length),l&&x.fill(l)}else{x=[];for(let p=0;p<t.length;++p){const T=this.getArrayForSample(t[p],m);Array.isArray(l)&&p<l.length?T.fill(l[p]):l&&!Array.isArray(l)&&T.fill(l),x.push(T)}}const d=s||await Gt(this.fileDirectory);return await this._readRaster(u,t,x,i,d,n,o,a,h)}async readRGB({window:e,interleave:t=!0,pool:i=null,width:s,height:n,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===V.RGB){let y=[0,1,2];if(this.fileDirectory.ExtraSamples!==ei.Unspecified&&a){y=[];for(let p=0;p<this.fileDirectory.BitsPerSample.length;p+=1)y.push(p)}return this.readRasters({window:e,interleave:t,samples:y,pool:i,width:s,height:n,resampleMethod:o,signal:l})}let f;switch(u){case V.WhiteIsZero:case V.BlackIsZero:case V.Palette:f=[0];break;case V.CMYK:f=[0,1,2,3];break;case V.YCbCr:case V.CIELab:f=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const g={window:h,interleave:!0,samples:f,pool:i,width:s,height:n,resampleMethod:o,signal:l},{fileDirectory:m}=this,c=await this.readRasters(g),x=2**this.fileDirectory.BitsPerSample[0];let d;switch(u){case V.WhiteIsZero:d=ri(c,x);break;case V.BlackIsZero:d=ii(c,x);break;case V.Palette:d=si(c,m.ColorMap);break;case V.CMYK:d=ni(c);break;case V.YCbCr:d=oi(c);break;case V.CIELab:d=hi(c);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const y=new Uint8Array(d.length/3),p=new Uint8Array(d.length/3),T=new Uint8Array(d.length/3);for(let _=0,E=0;_<d.length;_+=3,++E)y[E]=d[_],p[E]=d[_+1],T[E]=d[_+2];d=[y,p,T]}return d.width=c.width,d.height=c.height,d}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let s=Jr(i,"Item");e===null?s=s.filter(n=>De(n,"sample")===void 0):s=s.filter(n=>Number(De(n,"sample"))===e);for(let n=0;n<s.length;++n){const o=s[n];t[De(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(e){const[s,n,o]=e.getResolution();return[s*e.getWidth()/this.getWidth(),n*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[s,n,o,a,l,h,u,f]=this.fileDirectory.ModelTransformation,m=[[0,0],[0,t],[i,0],[i,t]].map(([d,y])=>[a+s*d+n*y,f+l*d+h*y]),c=m.map(d=>d[0]),x=m.map(d=>d[1]);return[Math.min(...c),Math.min(...x),Math.max(...c),Math.max(...x)]}else{const s=this.getOrigin(),n=this.getResolution(),o=s[0],a=s[1],l=o+n[0]*i,h=a+n[1]*t;return[Math.min(o,l),Math.min(a,h),Math.max(o,l),Math.max(a,h)]}}}class _i{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const i=this.getUint32(e,t),s=this.getUint32(e+4,t);let n;if(t){if(n=i+2**32*s,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*i+s,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}getInt64(e,t){let i=0;const s=(this._dataView.getUint8(e+(t?7:0))&128)>0;let n=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));s&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),i+=a*256**o}return s&&(i=-i),i}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Ct(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Ei{constructor(e,t,i,s){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=i,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),i=this.readUint32(e+4);let s;if(this._littleEndian){if(s=t+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*t+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(e){let t=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let s=!0;for(let n=0;n<8;n++){let o=this._dataView.getUint8(e+(this._littleEndian?n:7-n));i&&(s?o!==0&&(o=~(o-1)&255,s=!1):o=~o&255),t+=o*256**n}return i&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const wi=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Ai{constructor(e=wi,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(i=>{J(()=>import("./decoder-tqM1uIvc.js"),[],import.meta.url).then(s=>{i(s.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let s=0;s<e;s++)this.workers.push({worker:i(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Gt(e).then(i=>i.decode(e,t)):new Promise(i=>{const s=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const n=this.messageId++,o=a=>{a.data.id===n&&(s.idle=!0,i(a.data.decoded),s.worker.removeEventListener("message",o))};s.worker.addEventListener("message",o),s.worker.postMessage({fileDirectory:e,buffer:t,id:n},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const ut=`\r
\r
`;function Ot(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,i]of r)e[t.toLowerCase()]=i;return e}function bi(r){const e=r.split(`\r
`).map(t=>{const i=t.split(":").map(s=>s.trim());return i[0]=i[0].toLowerCase(),i});return Ot(e)}function Si(r){const[e,...t]=r.split(";").map(s=>s.trim()),i=t.map(s=>s.split("="));return{type:e,params:Ot(i)}}function Ue(r){let e,t,i;return r&&([,e,t,i]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),i=parseInt(i,10)),{start:e,end:t,total:i}}function Ii(r,e){let t=null;const i=new TextDecoder("ascii"),s=[],n=`--${e}`,o=`${n}--`;for(let a=0;a<10;++a)i.decode(new Uint8Array(r,a,n.length))===n&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const a=i.decode(new Uint8Array(r,t,Math.min(n.length+1024,r.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(n))throw new Error("Part does not start with boundary");const l=a.substr(n.length+2);if(l.length===0)break;const h=l.indexOf(ut),u=bi(l.substr(0,h)),{start:f,end:g,total:m}=Ue(u["content-range"]),c=t+n.length+h+ut.length,x=parseInt(g,10)+1-parseInt(f,10);s.push({headers:u,data:r.slice(c,c+x),offset:f,length:x,fileSize:m}),t=c+x+4}return s}class qe{async fetch(e,t=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Ri extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,i]of e)this.onEviction(t,i.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const i=t.get(e);return this._getItemValue(e,i)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield e)}for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:i=this.maxAge}={}){const s=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:s}):this._set(e,{value:t,expiry:s}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],i=t.length-e;i<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(i>0&&this._emitEvictions(t.slice(0,i)),this.oldCache=new Map(t.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const i=e[t],[s,n]=i;this._deleteIfExpired(s,n)===!1&&(yield[s,n.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const i=e[t],[s,n]=i;this.cache.has(s)||this._deleteIfExpired(s,n)===!1&&(yield[s,n.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[i,s]of this.entriesAscending())e.call(t,s,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function Di(r){return new Promise(e=>setTimeout(e,r))}function Fi(r,e){const t=Array.isArray(r)?r:Array.from(r),i=Array.isArray(e)?e:Array.from(e);return t.map((s,n)=>[s,i[n]])}class ie extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,ie),this.name="AbortError"}}class Pi extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const Mi=Pi;class Ci{constructor(e,t,i=null){this.offset=e,this.length=t,this.data=i}get top(){return this.offset+this.length}}class dt{constructor(e,t,i){this.offset=e,this.length=t,this.blockIds=i}}class vi extends qe{constructor(e,{blockSize:t=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new Ri({maxSize:i,onEviction:(s,n)=>{this.evictedBlocks.set(s,n)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const i=[],s=[],n=[];this.evictedBlocks.clear();for(const{offset:g,length:m}of e){let c=g+m;const{fileSize:x}=this;x!==null&&(c=Math.min(c,x));const d=Math.floor(g/this.blockSize)*this.blockSize;for(let y=d;y<c;y+=this.blockSize){const p=Math.floor(y/this.blockSize);!this.blockCache.has(p)&&!this.blockRequests.has(p)&&(this.blockIdsToFetch.add(p),s.push(p)),this.blockRequests.has(p)&&i.push(this.blockRequests.get(p)),n.push(p)}}await Di(),this.fetchBlocks(t);const o=[];for(const g of s)this.blockRequests.has(g)&&o.push(this.blockRequests.get(g));await Promise.allSettled(i),await Promise.allSettled(o);const a=[],l=n.filter(g=>this.abortedBlockIds.has(g)||!this.blockCache.has(g));if(l.forEach(g=>this.blockIdsToFetch.add(g)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const g of l){const m=this.blockRequests.get(g);if(!m)throw new Error(`Block ${g} is not in the block requests`);a.push(m)}await Promise.allSettled(a)}if(t&&t.aborted)throw new ie("Request was aborted");const h=n.map(g=>this.blockCache.get(g)||this.evictedBlocks.get(g)),u=h.filter(g=>!g);if(u.length)throw new Mi(u,"Request failed");const f=new Map(Fi(n,h));return this.readSliceData(e,f)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(t,e);for(let s=0;s<t.length;++s){const n=t[s];for(const o of n.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await i)[s],l=o*this.blockSize,h=l-a.offset,u=Math.min(h+this.blockSize,a.data.byteLength),f=a.data.slice(h,u),g=new Ci(l,f.byteLength,f,o);this.blockCache.set(o,g),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let i=[],s=null;const n=[];for(const o of t)s===null||s+1===o?(i.push(o),s=o):(n.push(new dt(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[o],s=o);return n.push(new dt(i[0]*this.blockSize,i.length*this.blockSize,i)),n}readSliceData(e,t){return e.map(i=>{let s=i.offset+i.length;this.fileSize!==null&&(s=Math.min(this.fileSize,s));const n=Math.floor(i.offset/this.blockSize),o=Math.floor(s/this.blockSize),a=new ArrayBuffer(i.length),l=new Uint8Array(a);for(let h=n;h<=o;++h){const u=t.get(h),f=u.offset-i.offset,g=u.top-s;let m=0,c=0,x;f<0?m=-f:f>0&&(c=f),g<0?x=u.length-m:x=s-u.offset-m;const d=new Uint8Array(u.data,m,x);l.set(d,c)}return a})}}class Ye{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class He{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class Gi extends Ye{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Li extends He{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const i=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new Gi(i)}}class Oi extends Ye{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class Ui extends He{constructRequest(e,t){return new Promise((i,s)=>{const n=new XMLHttpRequest;n.open("GET",this.url),n.responseType="arraybuffer";for(const[o,a]of Object.entries(e))n.setRequestHeader(o,a);n.onload=()=>{const o=n.response;i(new Oi(n,o))},n.onerror=s,n.onabort=()=>s(new ie("Request aborted")),n.send(),t&&(t.aborted&&n.abort(),t.addEventListener("abort",()=>n.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Pe={};class Bi extends Ye{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class ki extends He{constructor(e){super(e),this.parsedUrl=Pe.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Pe)}constructRequest(e,t){return new Promise((i,s)=>{const n=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const h=[];o.on("data",u=>{h.push(u)}),o.on("end",()=>{const u=Buffer.concat(h).buffer;l(u)}),o.on("error",s)});i(new Bi(o,a))});n.on("error",s),t&&(t.aborted&&n.destroy(new ie("Request aborted")),t.addEventListener("abort",()=>n.destroy(new ie("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class $e extends qe{constructor(e,t,i,s){super(),this.client=e,this.headers=t,this.maxRanges=i,this.allowFullFile=s,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(i=>this.fetchSlice(i,t))))}async fetchSlices(e,t){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:s,length:n})=>`${s}-${s+n}`).join(",")}`},signal:t});if(i.ok)if(i.status===206){const{type:s,params:n}=Si(i.getHeader("content-type"));if(s==="multipart/byteranges"){const f=Ii(await i.getData(),n.boundary);return this._fileSize=f[0].fileSize||null,f}const o=await i.getData(),{start:a,end:l,total:h}=Ue(i.getHeader("content-range"));this._fileSize=h||null;const u=[{data:o,offset:a,length:l-a}];if(e.length>1){const f=await Promise.all(e.slice(1).map(g=>this.fetchSlice(g,t)));return u.concat(f)}return u}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await i.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:i,length:s}=e,n=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+s}`},signal:t});if(n.ok)if(n.status===206){const o=await n.getData(),{total:a}=Ue(n.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:i,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await n.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Ze(r,{blockSize:e,cacheSize:t}){return e===null?r:new vi(r,{blockSize:e,cacheSize:t})}function Ni(r,{headers:e={},credentials:t,maxRanges:i=0,allowFullFile:s=!1,...n}={}){const o=new Li(r,t),a=new $e(o,e,i,s);return Ze(a,n)}function ji(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...s}={}){const n=new Ui(r),o=new $e(n,e,t,i);return Ze(o,s)}function zi(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...s}={}){const n=new ki(r),o=new $e(n,e,t,i);return Ze(o,s)}function Be(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?Ni(r,t):typeof XMLHttpRequest<"u"?ji(r,t):zi(r,t)}class Vi extends qe{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((i,s)=>{const n=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>i(a.target.result),o.onerror=s,o.onabort=s,o.readAsArrayBuffer(n),t&&t.addEventListener("abort",()=>o.abort())})}}function Ki(r){return new Vi(r)}function ke(r){switch(r){case S.BYTE:case S.ASCII:case S.SBYTE:case S.UNDEFINED:return 1;case S.SHORT:case S.SSHORT:return 2;case S.LONG:case S.SLONG:case S.FLOAT:case S.IFD:return 4;case S.RATIONAL:case S.SRATIONAL:case S.DOUBLE:case S.LONG8:case S.SLONG8:case S.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function Xi(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let i=4;i<=e[3]*4;i+=4){const s=ti[e[i]],n=e[i+1]?ce[e[i+1]]:null,o=e[i+2],a=e[i+3];let l=null;if(!n)l=a;else{if(l=r[n],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[s]=l}return t}function te(r,e,t,i){let s=null,n=null;const o=ke(e);switch(e){case S.BYTE:case S.ASCII:case S.UNDEFINED:s=new Uint8Array(t),n=r.readUint8;break;case S.SBYTE:s=new Int8Array(t),n=r.readInt8;break;case S.SHORT:s=new Uint16Array(t),n=r.readUint16;break;case S.SSHORT:s=new Int16Array(t),n=r.readInt16;break;case S.LONG:case S.IFD:s=new Uint32Array(t),n=r.readUint32;break;case S.SLONG:s=new Int32Array(t),n=r.readInt32;break;case S.LONG8:case S.IFD8:s=new Array(t),n=r.readUint64;break;case S.SLONG8:s=new Array(t),n=r.readInt64;break;case S.RATIONAL:s=new Uint32Array(t*2),n=r.readUint32;break;case S.SRATIONAL:s=new Int32Array(t*2),n=r.readInt32;break;case S.FLOAT:s=new Float32Array(t),n=r.readFloat32;break;case S.DOUBLE:s=new Float64Array(t),n=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===S.RATIONAL||e===S.SRATIONAL)for(let a=0;a<t;a+=2)s[a]=n.call(r,i+a*o),s[a+1]=n.call(r,i+(a*o+4));else for(let a=0;a<t;++a)s[a]=n.call(r,i+a*o);return e===S.ASCII?new TextDecoder("utf-8").decode(s):s}class qi{constructor(e,t,i){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=i}}class ye extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Ut{async readRasters(e={}){const{window:t,width:i,height:s}=e;let{resX:n,resY:o,bbox:a}=e;const l=await this.getImage();let h=l;const u=await this.getImageCount(),f=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(i||s){if(t){const[c,x]=l.getOrigin(),[d,y]=l.getResolution();a=[c+t[0]*d,x+t[1]*y,c+t[2]*d,x+t[3]*y]}const m=a||f;if(i){if(n)throw new Error("Both width and resX passed");n=(m[2]-m[0])/i}if(s){if(o)throw new Error("Both width and resY passed");o=(m[3]-m[1])/s}}if(n||o){const m=[];for(let c=0;c<u;++c){const x=await this.getImage(c),{SubfileType:d,NewSubfileType:y}=x.fileDirectory;(c===0||d===2||y&1)&&m.push(x)}m.sort((c,x)=>c.getWidth()-x.getWidth());for(let c=0;c<m.length;++c){const x=m[c],d=(f[2]-f[0])/x.getWidth(),y=(f[3]-f[1])/x.getHeight();if(h=x,n&&n>d||o&&o>y)break}}let g=t;if(a){const[m,c]=l.getOrigin(),[x,d]=h.getResolution(l);g=[Math.round((a[0]-m)/x),Math.round((a[1]-c)/d),Math.round((a[2]-m)/x),Math.round((a[3]-c)/d)],g=[Math.min(g[0],g[2]),Math.min(g[1],g[3]),Math.max(g[0],g[2]),Math.max(g[1],g[3])]}return h.readRasters({...e,window:g})}}let _e=class Bt extends Ut{constructor(e,t,i,s,n={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=i,this.firstIFDOffset=s,this.cache=n.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const i=this.bigTiff?4048:1024;return new Ei((await this.source.fetch([{offset:e,length:typeof t<"u"?t:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,i=this.bigTiff?8:2;let s=await this.getSlice(e);const n=this.bigTiff?s.readUint64(e):s.readUint16(e),o=n*t+(this.bigTiff?16:6);s.covers(e,o)||(s=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let f=0;f<n;l+=t,++f){const g=s.readUint16(l),m=s.readUint16(l+2),c=this.bigTiff?s.readUint64(l+4):s.readUint32(l+4);let x,d;const y=ke(m),p=l+(this.bigTiff?12:8);if(y*c<=(this.bigTiff?8:4))x=te(s,m,c,p);else{const T=s.readOffset(p),_=ke(m)*c;if(s.covers(T,_))x=te(s,m,c,T);else{const E=await this.getSlice(T,_);x=te(E,m,c,T)}}c===1&&Qr.indexOf(g)===-1&&!(m===S.RATIONAL||m===S.SRATIONAL)?d=x[0]:d=x,a[ce[g]]=d}const h=Xi(a),u=s.readOffset(e+i+t*n);return new qi(a,h,u)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof ye?new ye(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new ye(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new Lt(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof ye)t=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",i=t.length+100;let s=await this.getSlice(e,i);if(t===te(s,S.ASCII,t.length,e)){const o=te(s,S.ASCII,i,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>i&&(s=await this.getSlice(e,a));const l=te(s,S.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(h=>h.length>0).map(h=>h.split("=")).forEach(([h,u])=>{this.ghostValues[h]=u})}return this.ghostValues}static async fromSource(e,t,i){const s=(await e.fetch([{offset:0,length:1024}],i))[0],n=new _i(s),o=n.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=n.getUint16(2,a);let h;if(l===42)h=!1;else if(l===43){if(h=!0,n.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=h?n.getUint64(8,a):n.getUint32(4,a);return new Bt(e,a,h,u,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}};class Yi extends Ut{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,i=0;for(let s=0;s<this.imageFiles.length;s++){const n=this.imageFiles[s];for(let o=0;o<this.imageCounts[s];o++){if(e===t){const a=await n.requestIFD(i);return new Lt(a.fileDirectory,a.geoKeyDirectory,n.dataView,n.littleEndian,n.cache,n.source)}t++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,i)=>t+i,0),this.imageCount}}async function Hi(r,e={},t){return _e.fromSource(Be(r,e),t)}async function $i(r,e){return _e.fromSource(Ki(r),e)}async function Zi(r,e=[],t={},i){const s=await _e.fromSource(Be(r,t),i),n=await Promise.all(e.map(o=>_e.fromSource(Be(o,t))));return new Yi(s,n)}const Wi=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,Ji=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class Qi{constructor(e){this.gl_=e,this.program_=Ne(e,Ji,Wi),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,i,s,n,o,a,l,h,u,f,g,m){const c=this.gl_;l===void 0&&(l=s),h===void 0&&(h=n),o===void 0&&(o=t),a===void 0&&(a=i),u===void 0&&(u=o),f===void 0&&(f=a),g===void 0&&(g=c.canvas.width),m===void 0&&(m=c.canvas.height),c.bindTexture(c.TEXTURE_2D,e),c.useProgram(this.program_),c.bindBuffer(c.ARRAY_BUFFER,this.positionBuffer),c.enableVertexAttribArray(this.positionLocation),c.vertexAttribPointer(this.positionLocation,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this.texcoordBuffer),c.enableVertexAttribArray(this.texcoordLocation),c.vertexAttribPointer(this.texcoordLocation,2,c.FLOAT,!1,0,0);let x=ve(0,g,0,m,-1,1);x=qt(x,l,h,0),x=We(x,u,f,1),c.uniformMatrix4fv(this.matrixLocation,!1,x);let d=Yt(s/t,n/i,0);d=We(d,o/t,a/i,1),c.uniformMatrix4fv(this.textureMatrixLocation,!1,d),c.uniform1i(this.textureLocation,0),c.drawArrays(c.TRIANGLES,0,this.positions.length/2)}}function gt(r,e,t){const i=r.createShader(e);if(i===null)throw new Error("Shader compilation failed");if(r.shaderSource(i,t),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS)){const s=r.getShaderInfoLog(i);throw s===null?new Error("Shader info log creation failed"):new Error(s)}return i}function Ne(r,e,t){const i=r.createProgram(),s=gt(r,r.VERTEX_SHADER,t),n=gt(r,r.FRAGMENT_SHADER,e);if(i===null)throw new Error("Program creation failed");if(r.attachShader(i,s),r.attachShader(i,n),r.linkProgram(i),!r.getProgramParameter(i,r.LINK_STATUS))throw r.getProgramInfoLog(i)===null?new Error("Program info log creation failed"):new Error;return i}const es=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,ts=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,rs=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,is=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function ss(r,e,t,i){let s;return t&&t.length?s=t.shift():Ht?s=new OffscreenCanvas(r||300,e||300):s=document.createElement("canvas"),r&&(s.width=r),e&&(s.height=e),s.getContext("webgl",i)}function ns(r){const e=r.canvas;e.width=1,e.height=1,r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT)}const mt=[];function os(r,e,t,i,s,n,o,a,l,h,u,f,g,m){const c=Math.round(i*e),x=Math.round(i*t);r.canvas.width=c,r.canvas.height=x;let d,y;if(y=r.createTexture(),r.bindTexture(r.TEXTURE_2D,y),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),g?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,c,x,0,r.RGBA,u,null),d=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,d),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,y,0),d===null)throw new Error("Could not create framebuffer");if(y===null)throw new Error("Could not create texture");if(l.length===0)return{width:c,height:x,framebuffer:d,texture:y};const p=Zt();l.forEach(function(w,P,b){$t(p,w.extent)});let T,_,E;const I=1/s;{if(T=r.createTexture(),y===null)throw new Error("Could not create texture");_=Math.round(Te(p)*I),E=Math.round(Ae(p)*I);const w=r.getParameter(r.MAX_TEXTURE_SIZE),P=Math.max(_,E),b=P>w?w/P:1,M=Math.round(_*b),G=Math.round(E*b);r.bindTexture(r.TEXTURE_2D,T),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),g?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,M,G,0,r.RGBA,u,null);const D=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,D),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,T,0);const k=new Qi(r);l.forEach(function(C,j,L){const v=(C.extent[0]-p[0])*I*b,B=-(C.extent[3]-p[3])*I*b,q=Te(C.extent)*I*b,O=Ae(C.extent)*I*b;if(r.bindFramebuffer(r.FRAMEBUFFER,D),r.viewport(0,0,M,G),C.clipExtent){const K=(C.clipExtent[0]-p[0])*I*b,Y=-(C.clipExtent[3]-p[3])*I*b,X=Te(C.clipExtent)*I*b,H=Ae(C.clipExtent)*I*b;r.enable(r.SCISSOR_TEST),r.scissor(g?K:Math.round(K),g?Y:Math.round(Y),g?X:Math.round(K+X)-Math.round(K),g?H:Math.round(Y+H)-Math.round(Y))}k.drawImage(C.texture,C.width,C.height,h,h,C.width-2*h,C.height-2*h,g?v:Math.round(v),g?B:Math.round(B),g?q:Math.round(v+q)-Math.round(v),g?O:Math.round(B+O)-Math.round(B),M,G),r.disable(r.SCISSOR_TEST)}),r.deleteFramebuffer(D)}const R=Je(o),A=Je(p),F=w=>{const P=(w[0][0]-R[0])/n*i,b=-(w[0][1]-R[1])/n*i,M=(w[1][0]-R[0])/n*i,G=-(w[1][1]-R[1])/n*i,D=(w[2][0]-R[0])/n*i,k=-(w[2][1]-R[1])/n*i;return{u1:M,v1:G,u0:P,v0:b,u2:D,v2:k}};r.bindFramebuffer(r.FRAMEBUFFER,d),r.viewport(0,0,c,x);{const w=[],P=[],b=Ne(r,is,rs);r.useProgram(b);const M=r.getUniformLocation(b,"u_texture");r.bindTexture(r.TEXTURE_2D,T),r.uniform1i(M,0),a.getTriangles().forEach(function(v,B,q){const O=v.source,K=v.target,{u1:Y,v1:X,u0:H,v0:we,u2:fe,v2:ee}=F(K),Nt=(O[0][0]-A[0])/s/_,jt=-(O[0][1]-A[1])/s/E,zt=(O[1][0]-A[0])/s/_,Vt=-(O[1][1]-A[1])/s/E,Kt=(O[2][0]-A[0])/s/_,Xt=-(O[2][1]-A[1])/s/E;w.push(Y,X,H,we,fe,ee),P.push(zt,Vt,Nt,jt,Kt,Xt)});const G=ve(0,c,x,0,-1,1),D=r.getUniformLocation(b,"u_matrix");r.uniformMatrix4fv(D,!1,G);const k=r.getAttribLocation(b,"a_position"),C=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,C),r.bufferData(r.ARRAY_BUFFER,new Float32Array(w),r.STATIC_DRAW),r.vertexAttribPointer(k,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(k);const j=r.getAttribLocation(b,"a_texcoord"),L=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,L),r.bufferData(r.ARRAY_BUFFER,new Float32Array(P),r.STATIC_DRAW),r.vertexAttribPointer(j,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(j),r.drawArrays(r.TRIANGLES,0,w.length/2)}if(f){const w=Ne(r,ts,es);r.useProgram(w);const P=ve(0,c,x,0,-1,1),b=r.getUniformLocation(w,"u_matrix");r.uniformMatrix4fv(b,!1,P);const M=Array.isArray(f)?f:[0,0,0,255],G=r.getUniformLocation(w,"u_val");r.uniform4fv(G,M);const D=r.getAttribLocation(w,"a_position"),k=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,k),r.vertexAttribPointer(D,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(D);const C=a.getTriangles().reduce(function(j,L){const v=L.target,{u1:B,v1:q,u0:O,v0:K,u2:Y,v2:X}=F(v);return j.concat([B,q,O,K,O,K,Y,X,Y,X,B,q])},[]);r.bufferData(r.ARRAY_BUFFER,new Float32Array(C),r.STATIC_DRAW),r.drawArrays(r.LINES,0,C.length/2)}return{width:c,height:x,framebuffer:d,texture:y}}class as extends Tt{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,i=t.getExtent(),s=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?s?oe(i,s):i:s;const n=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=o?oe(n,o):n;if(Qe(l)===0){this.state=U.EMPTY;return}i&&(a?a=oe(a,i):a=i);const h=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=e.targetProj,f=rr(t,u,l,h);if(!isFinite(f)||f<=0){this.state=U.EMPTY;return}const g=e.errorThreshold!==void 0?e.errorThreshold:ir;if(this.triangulation_=new sr(t,u,l,a,f*g,h,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=U.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(f);let m=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(m[1]=Ge(m[1],a[1],a[3]),m[3]=Ge(m[3],a[1],a[3])):m=oe(m,a)),!Qe(m))this.state=U.EMPTY;else{let c=0,x=0;t.canWrapX()&&(c=Te(i),x=Math.floor((m[0]-i[0])/c)),nr(m.slice(),t).forEach(y=>{const p=this.sourceTileGrid_.getTileRangeForExtentAndZ(y,this.sourceZ_),T=e.getTileFunction;for(let _=p.minX;_<=p.maxX;_++)for(let E=p.minY;E<=p.maxY;E++){const I=T(this.sourceZ_,_,E,this.pixelRatio_);if(I){const R=x*c;this.sourceTiles_.push({tile:I,offset:R})}}++x}),this.sourceTiles_.length===0&&(this.state=U.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(_=>{var B;const E=_.tile;if(!E||E.getState()!==U.LOADED)return;const I=E.getSize(),R=this.gutter_;let A;const F=Wt(E.getData());F?A=F:(t=!0,A=Jt(Qt(E.getData())));const w=[I[0]+2*R,I[1]+2*R],P=A instanceof Float32Array,b=w[0]*w[1],M=P?Float32Array:Uint8ClampedArray,G=new M(A.buffer),D=M.BYTES_PER_ELEMENT,k=D*G.length/b,C=G.byteLength/w[1],j=Math.floor(C/D/w[0]),L=this.sourceTileGrid_.getTileCoordExtent(E.tileCoord);L[0]+=_.offset,L[2]+=_.offset;const v=(B=this.clipExtent_)==null?void 0:B.slice();v&&(v[0]+=_.offset,v[2]+=_.offset),e.push({extent:L,clipExtent:v,data:G,dataType:M,bytesPerPixel:k,pixelSize:w,bandCount:j})}),this.sourceTiles_.length=0,e.length===0){this.state=U.ERROR,this.changed();return}const i=this.wrappedTileCoord_[0],s=this.targetTileGrid_.getTileSize(i),n=typeof s=="number"?s:s[0],o=typeof s=="number"?s:s[1],a=n*this.pixelRatio_,l=o*this.pixelRatio_,h=this.targetTileGrid_.getResolution(i),u=this.sourceTileGrid_.getResolution(this.sourceZ_),f=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),g=e[0].bandCount,m=new e[0].dataType(g*a*l),c=ss(a,l,mt,{premultipliedAlpha:!1,antialias:!1});let x;const d=c.RGBA;let y;e[0].dataType==Float32Array?(y=c.FLOAT,c.getExtension("WEBGL_color_buffer_float"),c.getExtension("OES_texture_float"),c.getExtension("EXT_float_blend"),x=c.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(y=c.UNSIGNED_BYTE,x=this.interpolate);const p=4,T=Math.ceil(g/p);for(let _=T-1;_>=0;--_){const E=[];for(let M=0,G=e.length;M<G;++M){const D=e[M],k=D.pixelSize,C=k[0],j=k[1],L=new D.dataType(p*C*j),v=D.data;let B=_*p;for(let O=0,K=L.length;O<K;O+=p)L[O]=v[B],L[O+1]=v[B+1],L[O+2]=v[B+2],L[O+3]=v[B+3],B+=g;const q=c.createTexture();c.bindTexture(c.TEXTURE_2D,q),x?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST)),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage2D(c.TEXTURE_2D,0,d,C,j,0,d,y,L),E.push({extent:D.extent,clipExtent:D.clipExtent,texture:q,width:C,height:j})}const{framebuffer:I,width:R,height:A}=os(c,n,o,this.pixelRatio_,u,h,f,this.triangulation_,E,this.gutter_,y,this.renderEdges_,x),F=R,w=A*p,P=new e[0].dataType(F*w);c.bindFramebuffer(c.FRAMEBUFFER,I),c.readPixels(0,0,R,A,c.RGBA,y,P);let b=_*p;for(let M=0,G=P.length;M<G;M+=p){const D=(F-1-(M/w|0))*w+M%w;m[b]=P[D],m[b+1]=P[D+1],m[b+2]=P[D+2],m[b+3]=P[D+3],b+=g}}if(ns(c),mt.push(c.canvas),t){const _=er(n,o),E=new ImageData(m,n);_.putImageData(E,0,0),this.reprojData_=_.canvas}else this.reprojData_=m;this.reprojSize_=[Math.round(a),Math.round(l)],this.state=U.LOADED,this.changed()}load(){if(this.state!==U.IDLE&&this.state!==U.ERROR)return;this.state=U.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i!==U.IDLE&&i!==U.LOADING)return;e++;const s=tr(t,_t.CHANGE,()=>{const n=t.getState();(n==U.LOADED||n==U.ERROR||n==U.EMPTY)&&(et(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==U.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(et),this.sourcesListenerKeys_=null}}class cs extends or{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&t&&(i=ar({extent:cr(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?be(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?be(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||Se(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,i,s,n){const o=this.tileGrid||this.getTileGridForProjection(n||s),a=Math.max.apply(null,o.getResolutions().map((m,c)=>{const x=be(o.getTileSize(c)),d=this.getTileSize(c);return Math.max(d[0]/x[0],d[1]/x[1])})),l=this.getTileGridForProjection(s),h=[e,t,i],u=this.getTileCoordForTileUrlFunction(h,s),f=Object.assign({sourceProj:n||s,sourceTileGrid:o,targetProj:s,targetTileGrid:l,tileCoord:h,wrappedTileCoord:u,pixelRatio:a,gutter:this.gutter_,getTileFunction:(m,c,x,d)=>this.getTile(m,c,x,d),transformMatrix:this.transformMatrix},this.tileOptions),g=new as(f);return g.key=this.getKey(),g}getTile(e,t,i,s,n){var T;const o=this.getProjection();if(n&&(o&&!Se(o,n)||this.transformMatrix))return this.getReprojTile_(e,t,i,n,o);const a=this.getTileSize(e),l=this.loader_,h=new AbortController,u={signal:h.signal,crossOrigin:this.crossOrigin_},f=this.getTileCoordForTileUrlFunction([e,t,i]);if(!f)return null;const g=f[0],m=f[1],c=f[2],x=(T=this.getTileGrid())==null?void 0:T.getFullTileRange(g);x&&(u.maxY=x.getHeight()-1);function d(){return fr(function(){return l(g,m,c,u)})}const y=Object.assign({tileCoord:[e,t,i],loader:d,size:a,controller:h},this.tileOptions),p=new Tt(y);return p.key=this.getKey(),p.addEventListener(_t.CHANGE,this.handleTileChange_),p}handleTileChange_(e){const t=e.target,i=Ie(t),s=t.getState();let n;s==U.LOADING?(this.tileLoadingKeys_[i]=!0,n=Re.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=s==U.ERROR?Re.TILELOADERROR:s==U.LOADED?Re.TILELOADEND:void 0),n&&this.dispatchEvent(new lr(n,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Se(t,e))&&!this.transformMatrix)return this.tileGrid;const i=Ie(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=hr(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,t){const i=Le(e);if(i){const s=Ie(i);s in this.tileGridForProjection_||(this.tileGridForProjection_[s]=t)}}}function ls(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function hs(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,i=V;return t===i.CMYK||t===i.YCbCr||t===i.CIELab||t===i.ICCLab}const xt="STATISTICS_MAXIMUM",pt="STATISTICS_MINIMUM",Me=256;let Ce;function fs(){return Ce||(Ce=new Ai),Ce}function us(r){try{return r.getBoundingBox(!0)}catch{return[0,0,r.getWidth(),r.getHeight()]}}function ds(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function gs(r,e){try{return r.getResolution(e)}catch{return[e.getWidth()/r.getWidth(),e.getHeight()/r.getHeight()]}}function ms(r){const e=r.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let i=Le(t);if(!i){const s=it(e.ProjLinearUnitsGeoKey);s&&(i=new st({code:t,units:s}))}return i}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let i=Le(t);if(!i){const s=it(e.GeogAngularUnitsGeoKey);s&&(i=new st({code:t,units:s}))}return i}return null}function xs(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let i=0;i<e;++i)t[i]=r.getImage(i);return Promise.all(t)})}function ps(r,e){let t;return r.blob?t=$i(r.blob):r.overviews?t=Zi(r.url,r.overviews,e):t=Hi(r.url,e),t.then(xs)}function ae(r,e,t,i,s){if(Array.isArray(r)){const n=r.length;if(!Array.isArray(e)||n!=e.length){const o=new Error(i);throw s(o),o}for(let o=0;o<n;++o)ae(r[o],e[o],t,i,s);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(i)}function ys(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function Ts(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class kt extends cs{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(n=>n.url).join(","));const i=this,s=new Array(t);for(let n=0;n<t;++n)s[n]=ps(this.sourceInfo_[n],this.sourceOptions_);Promise.all(s).then(function(n){i.configure_(n)}).catch(function(n){tt(n),i.error_=n,i.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let i=t.length-1;i>=0;--i){const s=t[i],n=ms(s);if(n){this.projection=n;break}}}determineTransformMatrix(e){const t=e[0];for(let i=t.length-1;i>=0;--i){const n=t[i].fileDirectory.ModelTransformation;if(n){const[o,a,l,h,u,f,g,m]=n,c=rt(rt([1/Math.sqrt(o*o+u*u),0,0,-1/Math.sqrt(a*a+f*f),h,m],[o,u,a,f,0,0]),[1,0,0,1,-h,-m]);this.transformMatrix=c,this.addAlpha_=!0;break}}}configure_(e){let t,i,s,n,o;const a=new Array(e.length),l=new Array(e.length),h=new Array(e.length);let u=0;const f=e.length;for(let d=0;d<f;++d){const y=[],p=[];e[d].forEach(F=>{ls(F)?p.push(F):y.push(F)});const T=y.length;if(p.length>0&&p.length!==T)throw new Error(`Expected one mask per image found ${p.length} masks and ${T} images`);let _,E;const I=new Array(T),R=new Array(T),A=new Array(T);l[d]=new Array(T),h[d]=new Array(T);for(let F=0;F<T;++F){const w=y[F],P=w.getGDALNoData();h[d][F]=w.getGDALMetadata(0),l[d][F]=P;const b=this.sourceInfo_[d].bands;a[d]=b?b.length:w.getSamplesPerPixel();const M=T-(F+1);_||(_=us(w)),E||(E=ds(w));const G=gs(w,y[0]);A[M]=G[0];const D=[w.getTileWidth(),w.getTileHeight()];D[0]!==D[1]&&D[1]<Me&&(D[0]=Me,D[1]=Me),I[M]=D;const k=G[0]/Math.abs(G[1]);R[M]=[D[0],D[1]/k]}if(t?oe(t,_,t):t=_,!i)i=E;else{const F=`Origin mismatch for source ${d}, got [${E}] but expected [${i}]`;ae(i,E,0,F,this.viewRejector)}if(!o)o=A,this.resolutionFactors_[d]=1;else{o.length-u>A.length&&(u=o.length-A.length);const F=o[o.length-1]/A[A.length-1];this.resolutionFactors_[d]=F;const w=A.map(b=>b*=F),P=`Resolution mismatch for source ${d}, got [${w}] but expected [${o}]`;ae(o.slice(u,o.length),w,.02,P,this.viewRejector)}s?ae(s.slice(u,s.length),R,.01,`Tile size mismatch for source ${d}`,this.viewRejector):s=R,n?ae(n.slice(u,n.length),I,0,`Tile size mismatch for source ${d}`,this.viewRejector):n=I,this.sourceImagery_[d]=y.reverse(),this.sourceMasks_[d]=p.reverse()}for(let d=0,y=this.sourceImagery_.length;d<y;++d){const p=this.sourceImagery_[d];for(;p.length<o.length;)p.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=h;e:for(let d=0;d<f;++d){if(this.sourceInfo_[d].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[d].length){this.addAlpha_=!0;break}const y=l[d],p=this.sourceInfo_[d].bands;if(p){for(let T=0;T<p.length;++T)if(y[p[T]-1]!==null){this.addAlpha_=!0;break e}continue}for(let T=0;T<y.length;++T)if(y[T]!==null){this.addAlpha_=!0;break e}}let g=this.addAlpha_?1:0;for(let d=0;d<f;++d)g+=a[d];this.bandCount=g;const m=new ur({extent:t,minZoom:u,origin:i,resolutions:o,tileSizes:s});this.tileGrid=m,this.setTileSizes(n),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const c=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let x=t;if(this.transformMatrix){const d=dr(gr(),this.transformMatrix.slice()),y=Tr(p=>_r(d,p));x=mr(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:pr(yr(x),this.projection),extent:xr(x,this.projection),zoom:c})}loadTile_(e,t,i,s){const n=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,h=this.sourceInfo_,u=fs();for(let f=0;f<o;++f){const g=h[f],m=this.resolutionFactors_[f],c=[Math.round(t*(n[0]*m)),Math.round(i*(n[1]*m)),Math.round((t+1)*(n[0]*m)),Math.round((i+1)*(n[1]*m))],x=this.sourceImagery_[f][e];let d;g.bands&&(d=g.bands.map(function(E){return E-1}));let y;"nodata"in g&&g.nodata!==null?y=g.nodata:d?y=d.map(function(E){return l[f][E]}):y=l[f];const p={window:c,width:n[0],height:n[1],samples:d,fillValue:y,pool:u,interleave:!1,signal:s.signal};hs(this.convertToRGB_,x)?a[f]=x.readRGB(p):a[f]=x.readRasters(p);const T=o+f,_=this.sourceMasks_[f][e];if(!_){a[T]=Promise.resolve(null);continue}a[T]=_.readRasters({window:c,width:n[0],height:n[1],samples:[0],pool:u,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,n)).catch(function(f){throw tt(f),f})}composeTile_(e,t){const i=this.metadata_,s=this.sourceInfo_,n=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,u=this.addAlpha_,f=e[0]*e[1],g=f*o;let m;h?m=new Uint8Array(g):m=new Float32Array(g);let c=0;for(let x=0;x<f;++x){let d=u;for(let y=0;y<n;++y){const p=s[y];let T=p.min,_=p.max,E,I;if(h){const R=i[y][0];T===void 0&&(R&&pt in R?T=parseFloat(R[pt]):T=ys(t[y][0])),_===void 0&&(R&&xt in R?_=parseFloat(R[xt]):_=Ts(t[y][0])),E=255/(_-T),I=-T*E}for(let R=0;R<a[y];++R){const A=t[y][R][x];let F;if(h?F=Ge(E*A+I,0,255):F=A,!u)m[c]=F;else{let w=p.nodata;if(w===void 0){let b;p.bands?b=p.bands[R]-1:b=R,w=l[y][b]}const P=isNaN(w);(!P&&A!==w||P&&!isNaN(A))&&(d=!1,m[c]=F)}c++}if(!d){const R=n+y,A=t[R];A&&!A[0][x]&&(d=!0)}}u&&(d||(m[c]=255),c++)}return m}}kt.prototype.getView;const bs=Object.freeze(Object.defineProperty({__proto__:null,default:kt},Symbol.toStringTag,{value:"Module"}));export{bs as G,ws as L,As as a};
